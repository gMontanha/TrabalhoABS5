CREATE OR REPLACE FUNCTION desempenho_medico(data_inicial date, data_final date) 
RETURNS 
SETOF RECORD
AS $$
DECLARE
	ATENDIMENTOS RECORD;
BEGIN	
	FOR ATENDIMENTOS IN
		SELECT M.NOME, COUNT(*) AS qtd
		FROM MEDICO M
		LEFT JOIN ATENDE AT 
			ON AT.ID_MEDICO = M.ID_MEDICO
		WHERE AT.DATA BETWEEN data_inicial AND data_final
		GROUP BY M.NOME
	LOOP 
	RETURN NEXT ATENDIMENTOS;
	END LOOP;
	RETURN;
END;
$$ LANGUAGE plpgsql;

SELECT * FROM desempenho_medico('2000-01-01', '2010-01-01') as (nome varchar, qtd bigint);
